<!-- ヘッダーの呼び出し -->
<%= render "layouts/header" %>

<div class="contaniner">

	<div class="row">
		<div class="col-md-offset-2 col-md-5">
		<span class="sentence_backcolor">ショッピングカート</span>
		</div>
	</div>

	<div class="row">
		<div class="col-md-offset-8">
		<%= link_to "カートを空にする", cart_items_empty_path, method: :delete, data:{confirm:"本当にカートを空にしますか？"}, class:"btn btn-danger" %>
		</div>
	</div><br>

	<!-- 商品一覧テーブル -->
	<div class="row">
		<div class="col-md-offset-2 col-md-8">
			<table class="table table-bordered">
				<thead>
					<tr class="info">
						<th>商品名</th>
						<th>単価(税込)</th>
						<th>数量</th>
						<th>小計</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<% @sum = 0 %>
					<% @cart_items.each do |cart_item| %>
					<tr>
						<td><%= cart_item.item.product_name %></td>

						<!-- 税込単価を定義 price_contain_tax -->
						<td>¥<%= price_contain_tax = (BigDecimal(cart_item.item.price) * BigDecimal("1.08")).round %></td>

						<td>
							<%= form_for cart_item, url:cart_item_path(cart_item.id), method: :patch do |f| %>
								<%= f.number_field :amount %>
								<%= f.submit "変更", class:"btn btn-primary" %>
							<% end %>
						</td>

						<td>¥<%= @total_price = price_contain_tax * cart_item.amount %></td>
						<% @sum = @sum + @total_price %>

						<td><%= link_to "削除する", cart_item_path(cart_item.id), method: :delete, data:{confirm:"削除しますか？"}, class:"btn btn-danger" %></td>
					</tr>
					<% end %>
				</tbody>
			</table>
		</div>
	</div>

	<div class="row">
		<div class="col-md-offset-2 col-md-4">
			<%= link_to "買い物を続ける", root_path, class:"btn btn-primary" %>
		</div>

		<div class="col-md-4">
			<table class="table table-bordered">
				<tr>
					<td class="info">合計金額</td>
					<td>¥<%= @sum %></td>
				</tr>
			</table>
		</div>
	</div><br>


	<div class="row">
		<div class="col-md-offset-5">
			<%= link_to "情報入力に進む", new_order_path, class:"btn btn-success btn-lg" %>
		</div>
	</div>

</div>

<footer></footer>








